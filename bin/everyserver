#!/bin/sh

ROOT=`dirname $0`
ROOT=`cd $ROOT/.. ; pwd`

# Add all necessary JAR files to the CLASSPATH
APPROOT=`echo $ROOT/server/target/everything-server-1.0-SNAPSHOT`
WEBDIR=$APPROOT/WEB-INF
export CLASSPATH=$ROOT/server/target/classes:`echo $WEBDIR/lib/*.jar | sed 's/ /:/g'`

# if we have a local config, read it in
if [ -f etc/everything.conf ]; then
    . etc/everything.conf
fi

if [ ! -z "NEW_RELIC_APP_NAME" ]; then
    NEW_RELIC_ARGS=-javaagent:lib/newrelic.jar
    echo "Host: $HOST"
fi

exec java \
    $NEW_RELIC_ARGS \
    -Djava.util.logging.config.file=$WEBDIR/classes/logging.properties \
    -Dorg.eclipse.jetty.util.log.class=org.eclipse.jetty.util.log.JavaUtilLog \
    -Dapproot=$APPROOT \
    com.threerings.everything.server.EverythingApp "$@"
